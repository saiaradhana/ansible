- hosts: all
  become: yes
  tasks:
    - name: yum update
      yum: name=* state=latest
      notify:
        - reboot
        - waiting
    - name: selinux disabled
      lineinfile:
        dest=/etc/selinux/config
        regexp=^SELINUX=
        line=SELINUX=disabled
      notify:
        - reboot
        - waiting
    - name: install vim
      yum: name=vim state=latest
      notify:
        - reboot
        - waiting
    - name: install bind-utils
      yum: name=bind-utils state=latest
      notify:
        - reboot
        - waiting
    - name: install wget
      yum: name=wget state=latest
      notify:
        - reboot
        - waiting
    - name: install git
      yum: name=git state=latest
      notify:
        - reboot
        - waiting
    - name: install traceroute
      yum: name=traceroute state=latest
      notify:
        - reboot
        - waiting
  handlers:
  - name: reboot
    shell: sleep 2 && shutdown -r now "Ansible updates triggered"
    async: 1
    poll: 0
    ignore_errors: true
  - name: waiting
    local_action: wait_for host={{ inventory_hostname }} port=22 delay=1 timeout=300
    become: false
